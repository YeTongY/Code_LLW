# 代号：LLW说明文档

## 项目简介：
本项目是一个简易的俯视角像素风RPG，以Raylib作为核心图形库，实现了RPG游戏应有的大多数功能。
本项目并非基于现成的游戏引擎（如 Unity/Godot），而是从底层构建了一套轻量级的游戏框架。游戏以“SIPC科协”为背景，融合了赛博朋克与故障艺术风格，玩家将扮演主角 Taffy，在被病毒“0x00”侵蚀的办公大楼中探索真相，净化被感染的同伴。

项目核心目标是实现 RPG 游戏的底层逻辑，包括地图解析、实体渲染、状态机管理及交互系统。

## 核心功能模块
- 状态切换：

- 地图加载：
基于 `tmxlite` 库深度定制，实现了从设计到运行时的无缝衔接。

*   **智能图层分类器**
    *   自动解析 Tiled 图层名称，将其映射为渲染层级：
        *   `Ground/Background`: 地板层（最底层，应用全屏滤镜）。
        *   `YSort` (包含 `Walls`, `Objects`, `Collision`): 实体层（参与动态排序）。
        *   `Decoration`: 挂墙装饰层（通过 Y 轴偏移修正遮挡关系）。
        *   `Overhead`: 头顶遮挡层（永远覆盖角色，如屋顶、门框）。
*   **2.5D 动态遮挡 (Y-Sorting)**
    *   摒弃了传统的“按图层顺序绘制”，构建了一个统一的 `Renderable` 列表。
    *   将**静态物体**与**动态实体**混合，根据**脚底 Y 坐标**进行实时排序 (`std::sort`)，完美解决了“角色绕柱走”时的遮挡穿模问题。
*   **物理碰撞生成**
    *   自动读取名为 `Collision` 的图层或标记为 `WALL` 的图块，生成逻辑网格，实现像素级精度的阻挡检测。
*   **大纹理兼容处理**
    *   解决了显卡纹理尺寸限制（Max 16384px）问题，支持加载切分后的子图集，保证了高清像素素材的兼容性。

- 角色渲染：

- 事件监听：

- 战斗状态：

- 对话系统：

- 敌人及NPC：
实现了完全数据驱动的实体系统，无需修改代码即可在编辑器中配置新敌人。

*   **多素材纹理字典 (Texture Map)**
    *   重构了单一纹理加载逻辑，引入 `std::map<string, Texture2D>`。
    *   支持通过 Tiled 的自定义属性 `enemyType` (如 "Pink", "Guard", "Boss") 动态加载并分配不同的外观素材。
*   **网格化移动 AI**
    *   实现了基于 **曼哈顿距离** 的移动算法，强制敌人沿 X 或 Y 轴移动，杜绝了斜向穿墙和卡在墙角的 BUG。
    *   **状态机行为**：
        *   `Patrol`: 在设定半径内随机游荡（包含边界检查）。
        *   `Chasing`: 进入索敌范围后，智能计算路径追击玩家。
*   **属性映射**
    *   自动解析 Tiled 对象属性 (`hp`, `attack`, `speed`) 并注入到 C++ 对象中，实现了“零代码调整数值”。

- 关卡设计：
设计并绘制了三个风格迥异的关卡，均采用环境叙事手法。

*   **Level 0: 隔离协议**
    *   *风格*：红色警报、混乱的办公区。
    *   *机制*：基础移动与交互教学。
*   **Level 0-1: 安全屋**
    *   *风格*：赛博朋克避难所，冷色调，高科技与低生活的结合。
    *   *机制*：剧情中转，无战斗，利用“线缆地狱”和“屏幕墙”营造氛围。
*   **Level 1: 0x00 错误溢出**
    *   *风格*：故障艺术 (Glitch Art)，数据中心。
    *   *机制*：**“恶搞迷宫”**。包含假路障（无碰撞）、假红毯（传送陷阱）、404 虚空房以及由服务器机柜构成的迷宫。

## 游戏玩法

## 外部库：
- Raylib图形库 （待补充）

- tmxlite

## 难点

### 1. 2.5D 渲染遮挡关系 (Y-Sorting)
*   **问题：** 在俯视角游戏中，当角色站在墙壁前方时应遮挡墙壁，站在后方时应被墙壁遮挡。简单的图层叠加无法实现动态遮挡。
*   **解决：** 重构了渲染管线。不再按图层顺序绘制，而是提取所有实体（玩家、敌人）和静态物体（墙壁、树木），将其放入一个渲染列表，根据实体的底部 Y 坐标（`visualPosition.y`）进行实时排序（`std::sort`），确保了正确的空间感。

### 2. 显卡纹理尺寸限制 (Texture Limits)
*   **问题：** 使用的高清像素素材包（Modern Interiors）其原始图集高度超过 30,000 像素，超过了主流显卡（如 RTX 3060）的最大纹理限制（16384px），导致游戏内素材显示为黑块。
*   **解决：** 使用AI编写 Python 脚本利用 Pillow 库对超大素材进行自动化切分，将其分割为多张小于 8192px 的子图集，并在 Tiled 中重新映射，解决了硬件兼容性问题。

### 3. Tiled 自定义属性与 C++ 的映射
*   **问题：** 如何让美术/关卡设计在 Tiled 中配置的参数（如敌人血量、巡逻范围、对话脚本路径）直接作用于代码。
*   **解决：** 在 `Map.cpp` 中编写了通用的属性解析器。通过读取 Tiled 对象层的 `Custom Properties`，自动将其转换为 C++ 中的变量（Int/Float/String），实现了“数据驱动”的开发模式，无需修改代码即可调整关卡数值。

### 