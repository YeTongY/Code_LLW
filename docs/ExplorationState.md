# æ¢ç´¢çŠ¶æ€å®ç°æ–¹æ¡ˆ

## ğŸ“‹ ç›®å½•
- [æ¦‚è¿°](#æ¦‚è¿°)
- [è®¾è®¡åŸåˆ™](#è®¾è®¡åŸåˆ™)
- [ä»£ç å®ç°](#ä»£ç å®ç°)
- [ä½¿ç”¨æ–¹æ³•](#ä½¿ç”¨æ–¹æ³•)
- [æ¶æ„å›¾](#æ¶æ„å›¾)

---

## æ¦‚è¿°

æ¢ç´¢çŠ¶æ€ï¼ˆExploration Stateï¼‰æ˜¯æ¸¸æˆä¸­çš„æ ¸å¿ƒçŠ¶æ€ä¹‹ä¸€ï¼Œè´Ÿè´£å¤„ç†ç©å®¶åœ¨å¤§åœ°å›¾ä¸­çš„è‡ªç”±æ¢ç´¢ã€‚æœ¬å®ç°**æœ€å¤§åŒ–å¤ç”¨**äº† Player æ¨¡å—å’Œ Map æ¨¡å—çš„ç°æœ‰å‡½æ•°ï¼Œéµå¾ª**æ¨¡å—åŒ–ã€èŒè´£åˆ†ç¦»**çš„è®¾è®¡åŸåˆ™ã€‚

---

## è®¾è®¡åŸåˆ™

### 1. **æœ€å¤§åŒ–å¤ç”¨ç°æœ‰ä»£ç **
- âœ… ä½¿ç”¨ `updatePlayer(ctx)` - å¤„ç†æ‰€æœ‰ç©å®¶è¾“å…¥å’Œç§»åŠ¨é€»è¾‘
- âœ… ä½¿ç”¨ `drawPlayer(ctx)` - å¤„ç†æ‰€æœ‰æ¸²æŸ“é€»è¾‘ï¼ˆåœ°å›¾+ç©å®¶ï¼‰
- âœ… ä½¿ç”¨ Player æ¨¡å—å®šä¹‰çš„ `TILE_SIZE` å¸¸é‡

### 2. **èŒè´£åˆ†ç¦»**
```
æ¢ç´¢çŠ¶æ€è´Ÿè´£ï¼š
  - çŠ¶æ€ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ˆè¿›å…¥/é€€å‡ºï¼‰
  - æ‘„åƒæœºè·Ÿéšç©å®¶
  - çŠ¶æ€åˆ‡æ¢é€»è¾‘ï¼ˆæˆ˜æ–—ã€äº¤äº’ï¼‰
  - UI æ˜¾ç¤ºï¼ˆä¸å½±å“æ¸¸æˆé€»è¾‘ï¼‰

Player æ¨¡å—è´Ÿè´£ï¼š
  - é”®ç›˜è¾“å…¥å¤„ç†
  - ç¢°æ’æ£€æµ‹
  - ç©å®¶ç§»åŠ¨
  - ç©å®¶æ¸²æŸ“

Map æ¨¡å—è´Ÿè´£ï¼š
  - åœ°å›¾æ•°æ®ç®¡ç†
  - åœ°å›¾æ¸²æŸ“
```

### 3. **ç¬¦åˆçŠ¶æ€æœºæ¶æ„**
- ä½¿ç”¨ `GameState` æ ‡å‡†æ¥å£
- ä½¿ç”¨ `GameStateMachine` è¿›è¡ŒçŠ¶æ€åˆ‡æ¢
- æ•°æ®å°è£…åœ¨ `ExplorationData` ä¸­

---

## ä»£ç å®ç°

### æ–‡ä»¶ç»“æ„
```
src/
  â”œâ”€â”€ ExplorationState.h    // å¤´æ–‡ä»¶å£°æ˜
  â”œâ”€â”€ Exploration.cpp        // å®ç°æ–‡ä»¶ï¼ˆå·²å®Œæˆï¼‰
  â”œâ”€â”€ Player.h              // ç©å®¶æ¨¡å—ï¼ˆé˜Ÿå‹å®Œæˆï¼‰
  â”œâ”€â”€ Player.cpp            // ç©å®¶å®ç°ï¼ˆé˜Ÿå‹å®Œæˆï¼‰
  â”œâ”€â”€ GameState.h           // çŠ¶æ€æœºæ¡†æ¶
  â””â”€â”€ GameState.cpp         // çŠ¶æ€æœºå®ç°
```

### æ ¸å¿ƒå®ç°

#### 1. è¿›å…¥æ¢ç´¢çŠ¶æ€ (`exploration_enter`)
```cpp
void exploration_enter(GameContext* ctx, void* state_data)
{
    ExplorationData* expd = (ExplorationData*)state_data;

    // åˆå§‹åŒ–æ¢ç´¢æ•°æ®
    expd->isActive = true;
    expd->elapsedTime = 0.0f;

    // åˆå§‹åŒ–æ‘„åƒæœº - è·Ÿéšç©å®¶
    const int TILE_SIZE = 32;
    ctx->camera.target = (Vector2){
        (float)(ctx->player.gridX * TILE_SIZE) + (TILE_SIZE / 2.0f),
        (float)(ctx->player.gridY * TILE_SIZE) + (TILE_SIZE / 2.0f)
    };
    ctx->camera.offset = (Vector2){ 
        ctx->screenWidth / 2.0f, 
        ctx->screenHeight / 2.0f 
    };
    ctx->camera.rotation = 0.0f;
    ctx->camera.zoom = 3.0f; // ä¸ drawPlayer ä¿æŒä¸€è‡´

    TraceLog(LOG_INFO, "[Exploration] è¿›å…¥æ¢ç´¢çŠ¶æ€");
}
```

#### 2. æ›´æ–°æ¢ç´¢çŠ¶æ€ (`exploration_update`)
```cpp
void exploration_update(GameContext* ctx, void* state_data)
{
    ExplorationData* expd = (ExplorationData*)state_data;
    if (!expd->isActive) return;

    // æ›´æ–°æ—¶é—´
    expd->elapsedTime += GetFrameTime();

    // æ ¸å¿ƒï¼šç›´æ¥è°ƒç”¨ Player æ¨¡å—çš„æ›´æ–°å‡½æ•°
    // å·²åŒ…å«ï¼šé”®ç›˜è¾“å…¥ã€ç¢°æ’æ£€æµ‹ã€ä½ç½®æ›´æ–°
    updatePlayer(*ctx);

    // æ‘„åƒæœºè·Ÿéšç©å®¶
    const int TILE_SIZE = 32;
    ctx->camera.target = (Vector2){
        (float)(ctx->player.gridX * TILE_SIZE) + (TILE_SIZE / 2.0f),
        (float)(ctx->player.gridY * TILE_SIZE) + (TILE_SIZE / 2.0f)
    };

    // å¤„ç†çŠ¶æ€åˆ‡æ¢
    if (IsKeyPressed(KEY_E)) {
        TraceLog(LOG_INFO, "[Exploration] æŒ‰ä¸‹Eé”® - è§¦å‘äº¤äº’");
        // æœªæ¥å¯ä»¥åˆ‡æ¢åˆ°æˆ˜æ–—çŠ¶æ€ï¼š
        // GameStateMachine_change(&ctx->state_machine, ctx, createCombatState());
    }

    if (IsKeyPressed(KEY_ESCAPE)) {
        ctx->isRunning = false;
    }
}
```

#### 3. æ¸²æŸ“æ¢ç´¢çŠ¶æ€ (`exploration_render`)
```cpp
void exploration_render(GameContext* ctx, void* state_data)
{
    ExplorationData* expd = (ExplorationData*)state_data;
    if (!expd->isActive) return;

    // æ ¸å¿ƒï¼šç›´æ¥è°ƒç”¨ Player æ¨¡å—çš„æ¸²æŸ“å‡½æ•°
    // å·²åŒ…å«ï¼šBeginMode2Dã€DrawMapã€ç»˜åˆ¶ç©å®¶ã€EndMode2D
    drawPlayer(*ctx);

    // UI ç»˜åˆ¶ï¼ˆåœ¨ EndMode2D ä¹‹åï¼Œä¸å—æ‘„åƒæœºå½±å“ï¼‰
    DrawText("æ¢ç´¢æ¨¡å¼", 10, 10, 20, BLACK);
    DrawText("æ“ä½œæç¤º:", 10, 40, 16, DARKGRAY);
    DrawText("  WASD - ç§»åŠ¨", 10, 60, 14, DARKGRAY);
    DrawText("  E - äº¤äº’", 10, 80, 14, DARKGRAY);
    DrawText("  ESC - é€€å‡º", 10, 100, 14, DARKGRAY);
    
    // æ˜¾ç¤ºç©å®¶ä¿¡æ¯
    char posText[64];
    sprintf(posText, "ä½ç½®: (%d, %d)", ctx->player.gridX, ctx->player.gridY);
    DrawText(posText, 10, ctx->screenHeight - 60, 16, DARKGREEN);
    
    char hpText[64];
    sprintf(hpText, "HP: %d/%d", ctx->player.stats.hp, ctx->player.stats.maxHp);
    DrawText(hpText, 10, ctx->screenHeight - 40, 16, RED);
    
    char timeText[64];
    sprintf(timeText, "æ—¶é—´: %.1fs", expd->elapsedTime);
    DrawText(timeText, 10, ctx->screenHeight - 20, 14, DARKGRAY);
}
```

#### 4. åˆ›å»ºæ¢ç´¢çŠ¶æ€ (`createExplorationState`)
```cpp
GameState* createExplorationState()
{
    // åˆ†é…æ¢ç´¢çŠ¶æ€æ•°æ®
    ExplorationData* expd = (ExplorationData*)malloc(sizeof(ExplorationData));
    if (!expd) {
        TraceLog(LOG_ERROR, "[Exploration] åˆ›å»ºå¤±è´¥ï¼šå†…å­˜åˆ†é…å¤±è´¥");
        return NULL;
    }
    
    // åˆ›å»ºçŠ¶æ€
    GameState* state = Gamestate_create(
        exploration_enter,      // è¿›å…¥å›è°ƒ
        exploration_exit,       // é€€å‡ºå›è°ƒ
        exploration_update,     // æ›´æ–°å›è°ƒ
        exploration_render,     // æ¸²æŸ“å›è°ƒ
        expd,                   // çŠ¶æ€æ•°æ®
        sizeof(ExplorationData) // æ•°æ®å¤§å°
    );
    
    if (!state) {
        TraceLog(LOG_ERROR, "[Exploration] åˆ›å»ºå¤±è´¥");
        free(expd);
        return NULL;
    }
    
    TraceLog(LOG_INFO, "[Exploration] åˆ›å»ºæˆåŠŸ");
    return state;
}
```

---

## ä½¿ç”¨æ–¹æ³•

### åœ¨ main.cpp ä¸­ä½¿ç”¨

```cpp
#include "raylib.h"
#include "GameState.h"
#include "ExplorationState.h"
#include "Player.h"
#include "Map.h"

int main()
{
    // åˆå§‹åŒ–çª—å£
    const int screenWidth = 1920;
    const int screenHeight = 1080;
    InitWindow(screenWidth, screenHeight, "Code_LLW");
    SetTargetFPS(60);
    
    // åˆ›å»ºæ¸¸æˆä¸Šä¸‹æ–‡
    GameContext ctx;
    ctx.screenWidth = screenWidth;
    ctx.screenHeight = screenHeight;
    ctx.isRunning = true;
    
    // åˆå§‹åŒ–ç©å®¶
    ctx.player.gridX = 5;
    ctx.player.gridY = 5;
    ctx.player.stats.hp = 100;
    ctx.player.stats.maxHp = 100;
    ctx.player.stats.attack = 10;
    ctx.player.stats.defense = 5;
    
    // åŠ è½½åœ°å›¾æ•°æ®ï¼ˆç¤ºä¾‹ï¼‰
    ctx.currentMapData = {
        {1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
        {1, 0, 0, 0, 0, 0, 0, 0, 0, 1},
        {1, 0, 0, 0, 0, 0, 0, 0, 0, 1},
        {1, 0, 0, 0, 1, 1, 0, 0, 0, 1},
        {1, 0, 0, 0, 1, 1, 0, 0, 0, 1},
        {1, 0, 0, 0, 0, 0, 0, 0, 0, 1},
        {1, 0, 0, 0, 0, 0, 0, 0, 0, 1},
        {1, 0, 0, 0, 0, 0, 0, 0, 0, 1},
        {1, 0, 0, 0, 0, 0, 0, 0, 0, 1},
        {1, 1, 1, 1, 1, 1, 1, 1, 1, 1}
    };
    
    // åˆå§‹åŒ–çŠ¶æ€æœº
    GameStateMachine_init(&ctx.state_machine);
    
    // åˆ›å»ºå¹¶è¿›å…¥æ¢ç´¢çŠ¶æ€
    GameState* explorationState = createExplorationState();
    if (explorationState) {
        GameStateMachine_change(&ctx.state_machine, &ctx, explorationState);
    }
    
    // æ¸¸æˆä¸»å¾ªç¯
    while (ctx.isRunning && !WindowShouldClose())
    {
        float dt = GetFrameTime();
        
        // æ›´æ–°çŠ¶æ€æœº
        GameStateMachine_update(&ctx.state_machine, &ctx, dt);
        
        // æ¸²æŸ“
        BeginDrawing();
        ClearBackground(RAYWHITE);
        
        GameStateMachine_render(&ctx.state_machine, &ctx);
        
        EndDrawing();
    }
    
    // æ¸…ç†
    GameStateMachine_shutdown(&ctx.state_machine, &ctx);
    CloseWindow();
    
    return 0;
}
```

---

## æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         main.cpp                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚          GameContext (æ¸¸æˆæ ¸å¿ƒæ•°æ®)                   â”‚   â”‚
â”‚  â”‚  - Player player                                     â”‚   â”‚
â”‚  â”‚  - vector<vector<int>> currentMapData                â”‚   â”‚
â”‚  â”‚  - Camera2D camera                                   â”‚   â”‚
â”‚  â”‚  - GameStateMachine state_machine                    â”‚   â”‚
â”‚  â”‚  - int screenWidth, screenHeight                     â”‚   â”‚
â”‚  â”‚  - bool isRunning                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                           â”‚                                  â”‚
â”‚                           â”‚                                  â”‚
â”‚                           â–¼                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚        GameStateMachine (çŠ¶æ€æœºç®¡ç†å™¨)                â”‚   â”‚
â”‚  â”‚  - current_state: GameState*                         â”‚   â”‚
â”‚  â”‚  - pending_state: GameState*                         â”‚   â”‚
â”‚  â”‚                                                       â”‚   â”‚
â”‚  â”‚  æ–¹æ³•ï¼š                                               â”‚   â”‚
â”‚  â”‚  + GameStateMachine_init()                           â”‚   â”‚
â”‚  â”‚  + GameStateMachine_change()                         â”‚   â”‚
â”‚  â”‚  + GameStateMachine_update()  â”€â”€â”€â”€â”€â”€â”                â”‚   â”‚
â”‚  â”‚  + GameStateMachine_render()  â”€â”€â”€â”€â”€â”€â”¤                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                          â”‚                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                                           â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚        ExplorationState (æ¢ç´¢çŠ¶æ€)                   â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚  â”‚  ExplorationData                               â”‚  â”‚
        â”‚  â”‚  - bool isActive                               â”‚  â”‚
        â”‚  â”‚  - float elapsedTime                           â”‚  â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
        â”‚                                                      â”‚
        â”‚  ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼š                                       â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚  â”‚ exploration_enter()                            â”‚  â”‚
        â”‚  â”‚  - åˆå§‹åŒ– ExplorationData                       â”‚  â”‚
        â”‚  â”‚  - è®¾ç½®æ‘„åƒæœºè·Ÿéšç©å®¶                           â”‚  â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
        â”‚                                                      â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚  â”‚ exploration_update()                           â”‚  â”‚
        â”‚  â”‚  - æ›´æ–°æ—¶é—´                                    â”‚  â”‚
        â”‚  â”‚  - è°ƒç”¨ updatePlayer() â—„â”€â”€â”€â”€â”                  â”‚  â”‚
        â”‚  â”‚  - æ›´æ–°æ‘„åƒæœºè·Ÿéš            â”‚                  â”‚  â”‚
        â”‚  â”‚  - å¤„ç†çŠ¶æ€åˆ‡æ¢ (Eé”®)        â”‚                  â”‚  â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
        â”‚                                 â”‚                    â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚  â”‚ exploration_render()         â”‚                 â”‚  â”‚
        â”‚  â”‚  - è°ƒç”¨ drawPlayer() â—„â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”              â”‚  â”‚
        â”‚  â”‚  - ç»˜åˆ¶ UI ä¿¡æ¯              â”‚  â”‚              â”‚  â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
        â”‚                                 â”‚  â”‚                 â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚  â”‚ exploration_exit()                             â”‚  â”‚
        â”‚  â”‚  - æ¸…ç†çŠ¶æ€æ•°æ®                                â”‚  â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚  â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                                               â”‚
                â–¼                                               â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   Player.cpp (å¤ç”¨)      â”‚              â”‚   Map.cpp (å¤ç”¨)          â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚ updatePlayer()          â”‚              â”‚ DrawMap()                â”‚
   â”‚  - å¤„ç† WASD è¾“å…¥       â”‚              â”‚  - æ¸²æŸ“åœ°å›¾æ•°æ®           â”‚
   â”‚  - ç¢°æ’æ£€æµ‹             â”‚              â”‚                          â”‚
   â”‚  - æ›´æ–°ç©å®¶ä½ç½®         â”‚              â”‚                          â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚ drawPlayer()            â”‚
   â”‚  - BeginMode2D()        â”‚
   â”‚  - è°ƒç”¨ DrawMap()  â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  - ç»˜åˆ¶ç©å®¶çŸ©å½¢         â”‚                     â”‚
   â”‚  - EndMode2D()          â”‚                     â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
                                                   â”‚
                    æ•°æ®æµå‘è¯´æ˜ï¼š                   â”‚
                    â•â•â•â•â•â•â•â•â•â•â•â•                   â”‚
                    1. main åˆå§‹åŒ– GameContext      â”‚
                    2. åˆ›å»º ExplorationState        â”‚
                    3. çŠ¶æ€æœºè°ƒç”¨ update/render     â”‚
                    4. æ¢ç´¢çŠ¶æ€å¤ç”¨ Player å‡½æ•° â”€â”€â”€â”€â”˜
                    5. Player å‡½æ•°å¤ç”¨ Map å‡½æ•°
```

---

## ä¼˜åŠ¿æ€»ç»“

### âœ… ä»£ç å¤ç”¨
- **100%** å¤ç”¨ `updatePlayer()` - æ‰€æœ‰ç§»åŠ¨é€»è¾‘
- **100%** å¤ç”¨ `drawPlayer()` - æ‰€æœ‰æ¸²æŸ“é€»è¾‘
- **0** è¡Œé‡å¤ä»£ç 

### âœ… èŒè´£åˆ†ç¦»
- æ¢ç´¢çŠ¶æ€ï¼šçŠ¶æ€ç®¡ç†ã€æ‘„åƒæœºã€UI
- Player æ¨¡å—ï¼šç©å®¶é€»è¾‘
- Map æ¨¡å—ï¼šåœ°å›¾é€»è¾‘

### âœ… å¯æ‰©å±•æ€§
- æ·»åŠ æ–°çŠ¶æ€åªéœ€å®ç° 4 ä¸ªå›è°ƒå‡½æ•°
- çŠ¶æ€åˆ‡æ¢é€šè¿‡ `GameStateMachine_change()`
- æ˜“äºæ·»åŠ æˆ˜æ–—çŠ¶æ€ã€èœå•çŠ¶æ€ç­‰

### âœ… æ˜“äºç»´æŠ¤
- ä¿®æ”¹ç©å®¶ç§»åŠ¨é€»è¾‘ï¼šåªæ”¹ `Player.cpp`
- ä¿®æ”¹åœ°å›¾æ¸²æŸ“ï¼šåªæ”¹ `Map.cpp`
- ä¿®æ”¹æ¢ç´¢æµç¨‹ï¼šåªæ”¹ `Exploration.cpp`

---

## æœªæ¥æ‰©å±•

### 1. æ·»åŠ æˆ˜æ–—çŠ¶æ€
```cpp
// åœ¨ exploration_update ä¸­
if (IsKeyPressed(KEY_E)) {
    GameState* combatState = createCombatState();
    GameStateMachine_change(&ctx->state_machine, ctx, combatState);
}
```

### 2. æ·»åŠ  NPC äº¤äº’
```cpp
// æ£€æµ‹ç©å®¶å‰æ–¹æ˜¯å¦æœ‰ NPC
if (checkNPCInFront(ctx) && IsKeyPressed(KEY_E)) {
    GameState* dialogueState = createDialogueState();
    GameStateMachine_change(&ctx->state_machine, ctx, dialogueState);
}
```

### 3. æ·»åŠ ç‰©å“æ‹¾å–
```cpp
// æ£€æµ‹ç©å®¶è„šä¸‹æ˜¯å¦æœ‰ç‰©å“
if (checkItemAtPlayerPosition(ctx)) {
    pickupItem(ctx);
}
```

---

## æ³¨æ„äº‹é¡¹

1. **æ‘„åƒæœº zoom å€¼è¦ä¸ Player.cpp ä¸€è‡´**
   - å½“å‰éƒ½è®¾ç½®ä¸º `3.0f`

2. **TILE_SIZE å¸¸é‡è¦ç»Ÿä¸€**
   - Player.cpp ä¸­å®šä¹‰ä¸º 32
   - Exploration.cpp ä¸­ä½¿ç”¨ç›¸åŒå€¼

3. **çŠ¶æ€åˆ‡æ¢åè®°å¾—é‡Šæ”¾èµ„æº**
   - ä½¿ç”¨ `GameState_destory()` é‡Šæ”¾æ—§çŠ¶æ€

4. **UI ç»˜åˆ¶åœ¨ EndMode2D ä¹‹å**
   - å¦åˆ™ä¼šè¢«æ‘„åƒæœºç¼©æ”¾å½±å“

---

## è”ç³»
- Player æ¨¡å—ï¼šwyt
- Map æ¨¡å—ï¼šgzb
- æ¢ç´¢çŠ¶æ€ï¼šWarning

---

**æœ€åæ›´æ–°**: 2025/11/16
